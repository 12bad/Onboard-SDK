# Onboard SDK 编程指南
---

## GPS坐标解算
将经纬度换算成北东坐标系。
实例中,‘origin_longti’及‘origin_lati’为原点位置经纬度，开发者可根据实际使用情况设定，建议采用飞行器起飞位置为原点位置；‘longti’及‘lati’为飞行器当前所在位置；‘x’，‘y’为解算出在北和东两个方向上相距原点的坐标，单位米。

~~~c
#define C_EARTH (double) 6378137.0
/* From GPS to Ground */
{
    double dlati = lati-origin_lati;
    double dlongti= longti-origin_longti;

    double x = dlati * C_EARTH;
    double y = dlongti * C_EARTH * cos(lati / 2.0 + origin_lati / 2.0);
}
~~~
## 位置控制(HORI_POS)
当水平方向采用位置控制模式（HORI_POS）时，水平方向上的输入量为当前位置与目标位置的偏移（offset）。
实例中,采用Ground坐标系，‘target’为目标位置坐标，‘current’为飞行器位置坐标，开发者可通过GPS、Guidance或其他传感器计算出相关坐标信息。例如采用本文当中“GPS坐标解算“部分通过GPS解算位置信息。
由于飞控接受的最大控制频率为50 Hz，因此为保证控制效果，offset的计算频率应至少大于50 Hz。
~~~c
/* Calculate offset */
{
    offset_x = target_x - current_x;
    offset_y = target_y - current_y;
}


/* Command thread */
attitude_data_t user_ctrl_data;
while(1)                                            
{
    /* HORI_POS VERT_VEL YAW_RATE HORI_GROUND_FRAME  YAW_GROUND_FRAME */
    user_ctrl_data.roll_or_x = offset_x;
    user_ctrl_data.pitch_or_y = offset_y;
    user_ctrl_data.thr_z = 0;
    user_ctrl_data.yaw = 0;
    DJI_Pro_Attitude_Control(&user_ctrl_data);
    usleep(20000);                                  /* 50 Hz*/
}
~~~

## 数据透传
TODO
## 激活
DJI_Pro_Activate_API(&user_act_data,NULL);
## 飞行状态切换

## 飞行状态切换（自动起飞、降落）
## 数据读取

